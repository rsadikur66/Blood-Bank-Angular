using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Web;

namespace BloodBankDAL.Repository.Query.Transaction
{
    public class T12202:CommonDAL
    {
        public DataTable getPatDetail(string P_PAT_NO,string P_NTNLTY_ID, string lang, string T_SITE_CODE)
        {
            //return Query($"SELECT T22.T_VITAL_ID,T22.T_UNIT_NO,T22.T_EPISODE_NO T_EPISODE_NO_22,T22.T_WEIGHT,T22.T_HB,T22.T_PULS,T22.T_TEMPTURE,T22.T_BP_HIGH,T22.T_BP_LOW,T22.T_REJECT_REASON,(SELECT LISTAGG(T12137.T_LANG{lang}_NAME,',') WITHIN GROUP(ORDER BY T12137.T_RES_CODE) FROM T12137 WHERE T12137.T_RES_CODE IN (T22.T_REJECT_REASON)) T_REJECT_DESC,T22.REC_DIF_DAY,T22.T_COMMENT,T22.T_DIFFERED_DATE,T22.T_DIFFERED_STATUS,DECODE(T22.T_DIFFERED_STATUS,NULL,'',1,'Permanent',2,'Temporary')DifferedReason,T22.T_ACCEPT_STATUS,T.* FROM (SELECT  T12071.T_DONOR_ID,T03001.T_PAT_NO,T03001.T_FIRST_LANG{lang}_NAME||' '|| T03001.T_FATHER_LANG{lang}_NAME||' '||T03001.T_GFATHER_LANG{lang}_NAME ||' '|| T03001.T_FAMILY_LANG{lang}_NAME PAT_NAME, T03001.T_GENDER T_SEX,T02006.T_LANG{lang}_NAME GENDER, T02007.T_LANG{lang}_NAME MRTL_STTS, T02003.T_LANG{lang}_NAME NATIONALITY, TRUNC(MONTHS_BETWEEN(SYSDATE,T03001.T_BIRTH_DATE) / 12, 0) YRS, TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T03001.T_BIRTH_DATE), 12), 0) MOS,T12017.T_EPISODE_NO, T12017.T_ENTRY_DATE EPISODE_DATE,T12017.T_REQUEST_ID,T12017.T_RESEARCH_STTS, MAX(T12071.T_DIFFERAL_DAY) DIFF_DAY, SYSDATE+MAX(T12071.T_DIFFERAL_DAY) DIFF_UPTO, MAX(T12068.T_IF_FAIL) DIFF_STTS, DECODE(MAX(T12068.T_IF_FAIL),NULL,'GREEN','1','YELLOW','2','RED') DIFF_STTS_SIGN, (SELECT COUNT(*) FROM T12017 WHERE T_ARRIVAL_DATE=SYSDATE) TOTAL_REG FROM T12071 INNER JOIN T12017 ON T12071.T_DONOR_PATNO = T12017.T_PAT_NO AND T12071.T_REQUEST_ID = T12017.T_REQUEST_ID INNER JOIN T12068 ON T12071.T_QNO = T12068.T_QNO INNER JOIN T03001 ON T03001.T_PAT_NO = T12071.T_DONOR_PATNO INNER JOIN T02006 ON T03001.T_GENDER = T02006.T_SEX_CODE INNER JOIN T02007 ON T03001.T_MRTL_STATUS = T02007.T_MRTL_STATUS_CODE INNER JOIN T02003 ON T03001.T_NTNLTY_CODE = T02003.T_NTNLTY_CODE WHERE T12071.T_DONOR_ID ='{P_NTNLTY_ID}' AND T12017.T_BLOOD_DONATION_STATUS='1' /*AND T12017.T_ENTRY_DATE <= SYSDATE-1*/ GROUP BY T12017.T_ENTRY_DATE,T03001.T_FIRST_LANG{lang}_NAME,T03001.T_FATHER_LANG{lang}_NAME,T03001.T_GFATHER_LANG{lang}_NAME, T03001.T_FAMILY_LANG{lang}_NAME, T03001.T_GENDER,T02006.T_LANG{lang}_NAME ,T02007.T_LANG{lang}_NAME , T02003.T_LANG{lang}_NAME ,T03001.T_BIRTH_DATE, T12017.T_EPISODE_NO,T03001.T_PAT_NO,T12017.T_REQUEST_ID, T12017.T_RESEARCH_STTS,T12071.T_DONOR_ID) T LEFT OUTER JOIN T12022 T22 ON T22.T_REQUEST_ID=T.T_REQUEST_ID");
            //return Query($"SELECT F.*, CASE WHEN F.DIFF_STTS IS NULL THEN 'GREEN' WHEN F.DIFF_STTS = 1 THEN 'YELLOW' WHEN F.DIFF_STTS = 2 THEN 'RED' ELSE 'WHITE' END DIFF_STTS_SIGN FROM (SELECT T22.T_VITAL_ID,T22.T_UNIT_NO,T22.T_EPISODE_NO T_EPISODE_NO_22,T22.T_WEIGHT,T22.T_HB,T22.T_PULS,T22.T_TEMPTURE,T22.T_BP_HIGH,T22.T_BP_LOW,T22.T_REJECT_REASON,(SELECT LISTAGG(T12137.T_LANG{lang}_NAME,',') WITHIN GROUP(ORDER BY T12137.T_RES_CODE) FROM T12137 WHERE T12137.T_RES_CODE IN (T22.T_REJECT_REASON)) T_REJECT_DESC,T22.REC_DIF_DAY,T22.T_COMMENT,T22.T_DIFFERED_DATE,T22.T_DIFFERED_STATUS,DECODE(T22.T_DIFFERED_STATUS,NULL,'',1,'Permanent',2,'Temporary')DifferedReason,T22.T_ACCEPT_STATUS,(SELECT DISTINCT MAX( CASE WHEN T12068.T_EXP_ANS = T12071.T_QNO_ANS AND T12022.T_REJECT_REASON IS NULL  AND (T12019.T_VIOROLOGY_RESULT <>'2' OR T12019.T_VIOROLOGY_RESULT IS NULL ) THEN NULL WHEN T12068.T_EXP_ANS = T12071.T_QNO_ANS AND (T12022.T_REJECT_REASON    IS NOT NULL OR T12019.T_VIOROLOGY_RESULT <>'2' OR T12019.T_VIOROLOGY_RESULT   IS NULL )  THEN 1 WHEN T12068.T_EXP_ANS <> T12071.T_QNO_ANS AND T12068.T_IF_FAIL   = '1'  AND (T12019.T_VIOROLOGY_RESULT <>'2' OR T12019.T_VIOROLOGY_RESULT     IS NULL ) THEN 1  WHEN T12068.T_EXP_ANS <> T12071.T_QNO_ANS AND T12068.T_IF_FAIL   = '2' THEN 2 WHEN T12019.T_VIOROLOGY_RESULT = '2' THEN 2 ELSE 0 END)  FROM T12068 INNER JOIN T12071   ON T12071.T_QNO = T12068.T_QNO LEFT JOIN T12022 ON T12022.T_PAT_NO=T12071.T_DONOR_PATNO LEFT JOIN T12019 ON T12019.T_UNIT_NO = T12022.T_UNIT_NO  WHERE ('{P_PAT_NO}' IS NULL OR T12071.T_DONOR_PATNO = '{P_PAT_NO}') AND ('{P_NTNLTY_ID}' IS NULL OR T12071.T_DONOR_ID = '{P_NTNLTY_ID}') AND T12071.T_REQUEST_ID=T.T_REQUEST_ID) DIFF_STTS,T.* FROM (SELECT  T12071.T_DONOR_ID,T03001.T_PAT_NO,T03001.T_FIRST_LANG{lang}_NAME||' '|| T03001.T_FATHER_LANG{lang}_NAME||' '||T03001.T_GFATHER_LANG{lang}_NAME ||' '|| T03001.T_FAMILY_LANG{lang}_NAME PAT_NAME, T03001.T_GENDER T_SEX,T02006.T_LANG{lang}_NAME GENDER, T02007.T_LANG{lang}_NAME MRTL_STTS, T02003.T_LANG{lang}_NAME NATIONALITY, TRUNC(MONTHS_BETWEEN(SYSDATE,T03001.T_BIRTH_DATE) / 12, 0) YRS, TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T03001.T_BIRTH_DATE), 12), 0) MOS,T12017.T_EPISODE_NO, T12017.T_ENTRY_DATE EPISODE_DATE,T12017.T_REQUEST_ID,T12017.T_RESEARCH_STTS, MAX(T12071.T_DIFFERAL_DAY) DIFF_DAY, SYSDATE+MAX(T12071.T_DIFFERAL_DAY) DIFF_UPTO, /*MAX(T12068.T_IF_FAIL) DIFF_STTS, DECODE(MAX(T12068.T_IF_FAIL),NULL,'GREEN','1','YELLOW','2','RED') DIFF_STTS_SIGN,*/ (SELECT COUNT(*) FROM T12017 WHERE T_ARRIVAL_DATE=SYSDATE) TOTAL_REG FROM T12071 INNER JOIN T12017 ON T12071.T_DONOR_PATNO = T12017.T_PAT_NO AND T12071.T_REQUEST_ID = T12017.T_REQUEST_ID INNER JOIN T12068 ON T12071.T_QNO = T12068.T_QNO INNER JOIN T03001 ON T03001.T_PAT_NO = T12071.T_DONOR_PATNO INNER JOIN T02006 ON T03001.T_GENDER = T02006.T_SEX_CODE INNER JOIN T02007 ON T03001.T_MRTL_STATUS = T02007.T_MRTL_STATUS_CODE INNER JOIN T02003 ON T03001.T_NTNLTY_CODE = T02003.T_NTNLTY_CODE WHERE ('{P_PAT_NO}' IS NULL OR T12071.T_DONOR_PATNO = '{P_PAT_NO}') AND ('{P_NTNLTY_ID}' IS NULL OR T12071.T_DONOR_ID = '{P_NTNLTY_ID}')  AND T12017.T_SITE_CODE='{T_SITE_CODE}'  AND T12017.T_BLOOD_DONATION_STATUS  IS NOT NULL /* AND T12017.T_ENTRY_DATE <= SYSDATE-1*/ GROUP BY T12017.T_ENTRY_DATE,T03001.T_FIRST_LANG{lang}_NAME,T03001.T_FATHER_LANG{lang}_NAME,T03001.T_GFATHER_LANG{lang}_NAME, T03001.T_FAMILY_LANG{lang}_NAME, T03001.T_GENDER,T02006.T_LANG{lang}_NAME ,T02007.T_LANG{lang}_NAME , T02003.T_LANG{lang}_NAME ,T03001.T_BIRTH_DATE, T12017.T_EPISODE_NO,T03001.T_PAT_NO,T12017.T_REQUEST_ID, T12017.T_RESEARCH_STTS,T12071.T_DONOR_ID) T LEFT OUTER JOIN T12022 T22 ON T22.T_REQUEST_ID=T.T_REQUEST_ID) F ORDER BY F.T_REQUEST_ID DESC");
            return Query($"SELECT F.*, CASE WHEN F.DIFF_STTS IS NULL THEN 'GREEN' WHEN F.DIFF_STTS = 1 THEN 'YELLOW' WHEN F.DIFF_STTS = 2 THEN 'RED' ELSE 'WHITE' END DIFF_STTS_SIGN FROM (SELECT T22.T_VITAL_ID,T22.T_UNIT_NO,T22.T_EPISODE_NO T_EPISODE_NO_22,T22.T_WEIGHT,T22.T_HB,T22.T_PULS,T22.T_TEMPTURE,T22.T_BP_HIGH,T22.T_BP_LOW,T22.T_REJECT_REASON,(SELECT LISTAGG(T12137.T_LANG{lang}_NAME,',') WITHIN GROUP(ORDER BY T12137.T_RES_CODE) FROM T12137 WHERE T12137.T_RES_CODE IN (T22.T_REJECT_REASON)) T_REJECT_DESC,T22.REC_DIF_DAY,T22.T_COMMENT,T22.T_DIFFERED_DATE,T22.T_DIFFERED_STATUS,DECODE(T22.T_DIFFERED_STATUS,NULL,'',1,'Permanent',2,'Temporary')DifferedReason,T22.T_ACCEPT_STATUS,(SELECT DISTINCT MAX(CASE WHEN T12068.T_EXP_ANS = T12071.T_QNO_ANS THEN NULL WHEN T12068.T_EXP_ANS <> T12071.T_QNO_ANS AND T12068.T_IF_FAIL  = '1' THEN 1 WHEN T12068.T_EXP_ANS <> T12071.T_QNO_ANS AND T12068.T_IF_FAIL   = '2' THEN 2 ELSE 0 END) FROM T12068 INNER JOIN T12071 ON T12071.T_QNO = T12068.T_QNO LEFT JOIN T12022  ON T12022.T_PAT_NO=T12071.T_DONOR_PATNO WHERE ('{P_PAT_NO}' IS NULL OR T12071.T_DONOR_PATNO = '{P_PAT_NO}') AND ('{P_NTNLTY_ID}' IS NULL OR T12071.T_DONOR_ID = '{P_NTNLTY_ID}') AND T12071.T_REQUEST_ID=T.T_REQUEST_ID AND T12071.T_QNO_ANS IS NOT NULL) DIFF_STTS,T.* FROM (SELECT  T12071.T_DONOR_ID,T03001.T_PAT_NO,T03001.T_FIRST_LANG{lang}_NAME||' '|| T03001.T_FATHER_LANG{lang}_NAME||' '||T03001.T_GFATHER_LANG{lang}_NAME ||' '|| T03001.T_FAMILY_LANG{lang}_NAME PAT_NAME, T03001.T_GENDER T_SEX,T02006.T_LANG{lang}_NAME GENDER, T02007.T_LANG{lang}_NAME MRTL_STTS, T02003.T_LANG{lang}_NAME NATIONALITY, TRUNC(MONTHS_BETWEEN(SYSDATE,T03001.T_BIRTH_DATE) / 12, 0) YRS, TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T03001.T_BIRTH_DATE), 12), 0) MOS,T12017.T_EPISODE_NO, T12017.T_ENTRY_DATE EPISODE_DATE,T12017.T_REQUEST_ID,T12017.T_RESEARCH_STTS, MAX(T12071.T_DIFFERAL_DAY) DIFF_DAY, SYSDATE+MAX(T12071.T_DIFFERAL_DAY) DIFF_UPTO, /*MAX(T12068.T_IF_FAIL) DIFF_STTS, DECODE(MAX(T12068.T_IF_FAIL),NULL,'GREEN','1','YELLOW','2','RED') DIFF_STTS_SIGN,*/ (SELECT COUNT(*) FROM T12017 WHERE T_ARRIVAL_DATE=SYSDATE) TOTAL_REG FROM T12071 INNER JOIN T12017 ON T12071.T_DONOR_PATNO = T12017.T_PAT_NO AND T12071.T_REQUEST_ID = T12017.T_REQUEST_ID INNER JOIN T12068 ON T12071.T_QNO = T12068.T_QNO INNER JOIN T03001 ON T03001.T_PAT_NO = T12071.T_DONOR_PATNO INNER JOIN T02006 ON T03001.T_GENDER = T02006.T_SEX_CODE INNER JOIN T02007 ON T03001.T_MRTL_STATUS = T02007.T_MRTL_STATUS_CODE INNER JOIN T02003 ON T03001.T_NTNLTY_CODE = T02003.T_NTNLTY_CODE WHERE ('{P_PAT_NO}' IS NULL OR T12071.T_DONOR_PATNO = '{P_PAT_NO}') AND ('{P_NTNLTY_ID}' IS NULL OR T12071.T_DONOR_ID = '{P_NTNLTY_ID}')  AND T12017.T_SITE_CODE='{T_SITE_CODE}'  AND T12017.T_BLOOD_DONATION_STATUS  IS NOT NULL /* AND T12017.T_ENTRY_DATE <= SYSDATE-1*/ GROUP BY T12017.T_ENTRY_DATE,T03001.T_FIRST_LANG{lang}_NAME,T03001.T_FATHER_LANG{lang}_NAME,T03001.T_GFATHER_LANG{lang}_NAME, T03001.T_FAMILY_LANG{lang}_NAME, T03001.T_GENDER,T02006.T_LANG{lang}_NAME ,T02007.T_LANG{lang}_NAME , T02003.T_LANG{lang}_NAME ,T03001.T_BIRTH_DATE, T12017.T_EPISODE_NO,T03001.T_PAT_NO,T12017.T_REQUEST_ID, T12017.T_RESEARCH_STTS,T12071.T_DONOR_ID) T LEFT OUTER JOIN T12022 T22 ON T22.T_REQUEST_ID=T.T_REQUEST_ID) F ORDER BY F.T_REQUEST_ID DESC");
        }

        public DataTable getQues(string P_PAT_NO,string P_NTNLTY_ID, int P_REQUEST_ID , string lang, string P_SEX)
        {
            //return Query($"SELECT DISTINCT T12068.T_QNO,T12068.T_LANG{lang}_NAME QUES_DESC,T12071.T_QNO_ANS,T12068.T_EXP_ANS,NVL(T12068.T_IF_FAIL, 0) T_IF_FAIL,T12071.T_DIFFERAL_DAY,T12071.T_QUES_ID FROM T12071 INNER JOIN T12017 ON T12071.T_DONOR_PATNO = T12017.T_PAT_NO  AND T12071.T_REQUEST_ID = T12017.T_REQUEST_ID LEFT JOIN T12068 ON T12071.T_QNO = T12068.T_QNO WHERE  ('{P_PAT_NO}' IS NULL OR T12071.T_DONOR_PATNO = '{P_PAT_NO}') AND ('{P_NTNLTY_ID}' IS NULL OR T12071.T_DONOR_ID = '{P_NTNLTY_ID}') AND T12017.T_REQUEST_ID={P_REQUEST_ID}  ORDER BY T_IF_FAIL DESC ");
            return Query($"SELECT DISTINCT T12068.T_QNO, T12068.T_LANG{lang}_NAME QUES_DESC,  T12071.T_QNO_ANS,  T12068.T_EXP_ANS,  NVL(T12068.T_IF_FAIL, 0) T_IF_FAIL,  NVL(T12071.T_DIFFERAL_DAY,T12068.T_DIFFERAL_DAY) T_DIFFERAL_DAY,  T12071.T_QUES_ID,TO_NUMBER(T12068.T_DISP_SEQ) T_DISP_SEQ,T12068.T_QHEAD_NO FROM T12068 INNER JOIN T12069  ON T12068.T_QHEAD_NO = T12069.T_QHEAD_NO LEFT JOIN T12071 ON T12071.T_QNO = T12068.T_QNO AND T12071.T_REQUEST_ID ={P_REQUEST_ID} WHERE(T12068.T_SEX  IS NULL OR T12068.T_SEX = '{P_SEX}')  ORDER BY T_DISP_SEQ");
        }

        public DataTable getValidation(string P_VITAL_CODE)
        {
            return Query($"SELECT T_MIN_VALUE ,T_MAX_VALUE FROM T02087 WHERE T_VITAL_CODE ='{P_VITAL_CODE}'");
        }
        public DataTable getValidationReason(string P_RES_CODE, string lang)
        {
            return Query($"SELECT 2 T_ACCEPT_STATUS,2 T_DIFFERED_STATUS,T_RES_CODE,T_LANG{lang}_NAME NAME FROM T12137 WHERE T_RES_CODE ='{P_RES_CODE}'");
        }
         public DataTable GetUnitData(string unitNo)
        {
            return Query($@"select t_unit_no from t12022 where t_unit_no=SUBSTR('{unitNo}', 2, 13) and t_unit_dig=SUBSTR('{unitNo}', -1, 1) and t_unit_char=SUBSTR('{unitNo}', -3, 2)");
        }

        public bool insert22(string T_ENTRY_USER, string T_PAT_NO, string T_EPISODE_NO, int T_REQUEST_ID, string T_SER_USE, DateTime T_MAX_DIFFERED_DATE,int T_MAX_DIFFERED_DAY, string T_WEIGHT, string T_TEMPTURE,string T_HB, string T_PULS, string T_BP_HIGH, string T_BP_LOW, string T_REJECT_REASON, int REC_DIF_DAY, string T_COMMENT, DateTime T_DIFFERED_DATE, string T_DIFFERED_STATUS, string T_ACCEPT_STATUS)
        {
            int vital = Int32.Parse(Query($"SELECT NVL(MAX(T_VITAL_ID), 0) + 1  T_VITAL_ID FROM T12022").Rows[0]["T_VITAL_ID"].ToString());
            bool t22= Command($"INSERT INTO T12022 (T_ENTRY_USER,T_ENTRY_DATE, T_PAT_NO, T_EPISODE_NO, T_REQUEST_ID,T_SER_USE,T_MAX_DIFFERED_DATE,T_MAX_DIFFERED_DAY,T_WEIGHT,T_TEMPTURE,T_HB,T_PULS,T_BP_HIGH,T_BP_LOW,T_REJECT_REASON,REC_DIF_DAY,T_COMMENT,T_DIFFERED_DATE,T_DIFFERED_STATUS,  T_ACCEPT_STATUS,T_VITAL_ID) VALUES ('{T_ENTRY_USER}',TRUNC(SYSDATE),'{T_PAT_NO}','{T_EPISODE_NO}','{T_REQUEST_ID}','{T_SER_USE}','{T_MAX_DIFFERED_DATE.Date.ToString("dd-MMM-yyyy")}',{T_MAX_DIFFERED_DAY},'{T_WEIGHT}','{T_TEMPTURE}','{T_HB}','{T_PULS}','{T_BP_HIGH}', '{T_BP_LOW}','{T_REJECT_REASON}',{REC_DIF_DAY},'{T_COMMENT}', '{T_DIFFERED_DATE.Date.ToString("dd-MMM-yyyy")}', '{T_DIFFERED_STATUS}', '{T_ACCEPT_STATUS}',{vital})");

            bool t17 = Command(
                $"UPDATE T12017 SET T_BLOOD_DONATION_STATUS=2,T_UPD_USER='{T_ENTRY_USER}',T_UPD_DATE=TRUNC(SYSDATE) WHERE T_REQUEST_ID={T_REQUEST_ID} AND T_PAT_NO='{T_PAT_NO}' AND T_EPISODE_NO='{T_EPISODE_NO}'");
            bool data = t22 && t17;
            return data;
        }

        public bool update22(string T_UPD_USER, string T_PAT_NO, string T_EPISODE_NO, int T_REQUEST_ID,
            string T_SER_USE, DateTime T_MAX_DIFFERED_DATE, int T_MAX_DIFFERED_DAY, string T_WEIGHT, string T_TEMPTURE,string T_HB, string T_PULS, string T_BP_HIGH, string T_BP_LOW, string T_REJECT_REASON, int REC_DIF_DAY,string T_COMMENT, DateTime T_DIFFERED_DATE, string T_DIFFERED_STATUS, string T_ACCEPT_STATUS,int T_VITAL_ID)
        {
            bool t22= Command($"UPDATE T12022 SET T_UPD_USER = '{T_UPD_USER}',T_UPD_DATE=TRUNC(SYSDATE) ,T_SER_USE='{T_SER_USE}',T_MAX_DIFFERED_DATE='{T_MAX_DIFFERED_DATE.Date.ToString("dd-MMM-yyyy")}',T_MAX_DIFFERED_DAY={T_MAX_DIFFERED_DAY}, T_WEIGHT='{T_WEIGHT}', T_TEMPTURE='{T_TEMPTURE}',T_HB='{T_HB}',T_PULS='{T_PULS}',T_BP_HIGH='{T_BP_HIGH}',T_BP_LOW='{T_BP_LOW}',T_REJECT_REASON='{T_REJECT_REASON}',REC_DIF_DAY={REC_DIF_DAY},T_COMMENT='{T_COMMENT}',T_DIFFERED_DATE='{T_DIFFERED_DATE.Date.ToString("dd-MMM-yyyy")}',T_DIFFERED_STATUS='{T_DIFFERED_STATUS}',T_ACCEPT_STATUS='{T_ACCEPT_STATUS}' WHERE T_VITAL_ID={T_VITAL_ID} AND T_PAT_NO='{T_PAT_NO}' AND T_REQUEST_ID='{T_REQUEST_ID}' AND T_EPISODE_NO='{T_EPISODE_NO}'");
            bool t17 = Command(
                $"UPDATE T12017 SET T_BLOOD_DONATION_STATUS=2,T_UPD_USER='{T_UPD_USER}',T_UPD_DATE=TRUNC(SYSDATE) WHERE T_REQUEST_ID={T_REQUEST_ID} AND T_PAT_NO='{T_PAT_NO}' AND T_EPISODE_NO='{T_EPISODE_NO}'");
            bool data = t22 && t17;
            return data;

        }

        public bool update71(string T_UPD_USER, string T_QNO, string T_QNO_ANS, int T_QUES_ID, int T_REQUEST_ID, string T_PAT_NO,string T_EPISODE_NO, int T_DIFFERAL_DAY)
        {
            bool t71= Command($"UPDATE T12071 SET T_QNO_ANS = '{T_QNO_ANS}' ,T_DIFFERAL_DAY={T_DIFFERAL_DAY},T_UPD_USER='{T_UPD_USER}',T_UPD_DATE=TRUNC(SYSDATE) WHERE T_QUES_ID={T_QUES_ID} AND T_REQUEST_ID={T_REQUEST_ID} AND T_DONOR_PATNO='{T_PAT_NO}' AND T_DONOR_EPISODE='{T_EPISODE_NO}'");
            bool t17 = Command(
                $"UPDATE T12017 SET T_BLOOD_DONATION_STATUS=2,T_UPD_USER='{T_UPD_USER}',T_UPD_DATE=TRUNC(SYSDATE) WHERE T_REQUEST_ID={T_REQUEST_ID} AND T_PAT_NO='{T_PAT_NO}' AND T_EPISODE_NO='{T_EPISODE_NO}'");
           bool  data = t71 && t17;
            return data;

        }
        public bool updateSingleQues71(string T_UPD_USER, string T_QNO, string T_QNO_ANS, int T_QUES_ID, int T_REQUEST_ID, string T_PAT_NO, string T_EPISODE_NO, int T_DIFFERAL_DAY)
        {
            return Command($"UPDATE T12071 SET T_QNO_ANS = '{T_QNO_ANS}' ,T_DIFFERAL_DAY={T_DIFFERAL_DAY},T_UPD_USER='{T_UPD_USER}',T_UPD_DATE=TRUNC(SYSDATE) WHERE T_QUES_ID={T_QUES_ID} AND T_REQUEST_ID={T_REQUEST_ID} AND T_DONOR_PATNO='{T_PAT_NO}' AND T_DONOR_EPISODE='{T_EPISODE_NO}'");

        }
        public int insertSingleQues71(string T_ENTRY_USER, string T_ENTRY_TIME, string T_DONOR_ID, string T_DONOR_PATNO, string T_DONOR_EPISODE, string T_QNO, string T_QNO_ANS, string T_QHEAD_NO, string T_DISP_SEQ, int T_DIFFERAL_DAY, int T_REQUEST_ID)
        {
            int ques = 0;
            ques = Int32.Parse(Query($"SELECT  NVL(MAX(T_QUES_ID), 0) + 1 T_QUES_ID FROM T12071").Rows[0]["T_QUES_ID"].ToString());
            if (ques>0)
            {
                Command($"INSERT INTO T12071 (T_ENTRY_USER,T_ENTRY_DATE,T_ENTRY_TIME,T_DONOR_ID,T_DONOR_PATNO,T_DONOR_EPISODE,T_QNO,T_QNO_ANS,T_QHEAD_NO,T_DISP_SEQ,T_DIFFERAL_DAY,T_REQUEST_ID,T_QUES_ID) VALUES ('{T_ENTRY_USER}',TRUNC(SYSDATE),'{T_ENTRY_TIME}','{T_DONOR_ID}','{T_DONOR_PATNO}','{T_DONOR_EPISODE}','{T_QNO}','{T_QNO_ANS}','{T_QHEAD_NO}','{T_DISP_SEQ}',{T_DIFFERAL_DAY},{T_REQUEST_ID},{ques})");
            }
            
            return ques;
        }
    }
}
          