using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Web;

namespace BloodBankDAL.Repository.Query.Query
{
    public class Q12012 : CommonDAL
    {
        public DataTable getAllXMatchData(string lang, string site, string req)
        {
            return Query($"SELECT T12.T_REQUEST_NO, T12.T_PAT_NO, T03.T_FIRST_LANG{lang}_NAME ||' ' || T03.T_FATHER_LANG{lang}_NAME ||' ' || T03.T_GFATHER_LANG{lang}_NAME ||' ' || T03.T_FAMILY_LANG{lang}_NAME AS PAT_NAME, TRUNC(MONTHS_BETWEEN(SYSDATE,T03.T_BIRTH_DATE) / 12, 0) YRS, TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T03.T_BIRTH_DATE), 12), 0) MOS, T06.T_LANG{lang}_NAME GENDER, T02.T_LANG{lang}_NAME NATIONALITY, T07.T_LANG{lang}_NAME MRTL_STTS, T13.T_ANTI_A, GET_T12302_DESC(T13.T_ANTI_A,1,{lang},1) T_ANTI_A_DESC , T13.T_ANTI_B, GET_T12302_DESC(T13.T_ANTI_B,1,{lang},1) T_ANTI_B_DESC , T13.T_ANTI_D, GET_T12302_DESC(T13.T_ANTI_D,1,{lang},1) T_ANTI_D_DESC , T13.T_CONTROL, GET_T12302_DESC(T13.T_CONTROL,1,2,1) T_CONTROL_DESC , T13.T_CELLS_A, GET_T12302_DESC(T13.T_CELLS_A,1,{lang},1) T_CELLS_A_DESC , T13.T_CELLS_B, GET_T12302_DESC(T13.T_CELLS_B,1,{lang},1) T_CELLS_B_DESC , T13.T_BLOOD_GROUP, GET_T12302_DESC(T13.T_BLOOD_GROUP,2,{lang},1) T_BLOOD_GROUP_DESC , T13.T_SC_I, GET_T12302_DESC(T13.T_SC_I,1,{lang},1) T_SC_I_DESC , T13.T_SC_II, GET_T12302_DESC(T13.T_SC_II,1,{lang},1) T_SC_II_DESC , T13.T_SC_III, GET_T12302_DESC(T13.T_SC_III,1,{lang},1) T_SC_III_DESC , T13.T_SC_III, GET_T12302_DESC(T13.T_SC_III,1,{lang},1) T_SC_III_DESC , T13.T_AUTO_CONTROL, GET_T12302_DESC(T13.T_AUTO_CONTROL,1,{lang},1) T_AUTO_CONTROL_DESC , T13.T_DCT, GET_T12302_DESC(T13.T_DCT,3,{lang},1) T_DCT_DESC , ANTIBODY_IDENTIFICATION(T12.T_REQUEST_NO) ANTIBODY_IDENTIFICATION, GET_T12302_DESC(T13.T_ENTRY_USER,4,{lang},2) TECH_NAME ,T13.T_ENTRY_DATE ,T13.T_TS_START_TIME FROM T12012 T12 LEFT JOIN T03001 T03 ON T03.T_PAT_NO=T12.T_PAT_NO LEFT JOIN T02006 T06 ON T03.T_GENDER=T06.T_SEX_CODE LEFT JOIN T02003 T02 ON T03.T_NTNLTY_CODE = T02.T_NTNLTY_CODE LEFT JOIN T02007 T07 ON T03.T_MRTL_STATUS = T07.T_MRTL_STATUS_CODE LEFT JOIN T12013 T13 ON T13.T_REQUEST_NO =T12.T_REQUEST_NO WHERE ('{req}' IS NULL OR T12.T_PAT_NO ='{req}') AND T12.T_SITE_CODE = '{site}' ORDER BY T12.T_REQUEST_DATE DESC");

        }
    }
}